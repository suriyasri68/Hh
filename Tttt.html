<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HabitVerse Ultimate</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:"Segoe UI",sans-serif;}

.background{
position:fixed;width:100%;height:100%;
background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);
overflow:hidden;
}
.bubble{
position:absolute;bottom:-120px;
background:rgba(255,255,255,0.15);
border-radius:50%;
animation:float 20s linear infinite;
}
@keyframes float{to{transform:translateY(-130vh);}}

.login-box{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
background:rgba(255,255,255,0.18);
backdrop-filter:blur(12px);
padding:35px 30px;border-radius:18px;
width:320px;text-align:center;
box-shadow:0 0 30px rgba(0,0,0,0.4);
color:white;
}
.login-box input{
width:100%;padding:12px;border:none;
border-radius:10px;margin-bottom:15px;
}
.login-box button{
width:100%;padding:12px;border:none;
border-radius:10px;background:#ff9800;
color:white;font-size:16px;cursor:pointer;
}

#appPage{
display:none;min-height:100vh;
background:linear-gradient(to right,#141e30,#243b55);
color:white;padding:20px;
}
.top-bar{
display:flex;justify-content:space-between;
align-items:center;margin-bottom:15px;
}
.controls{
display:grid;grid-template-columns:1fr 1fr auto;
gap:10px;margin-bottom:15px;
}
.controls input,.controls select,.controls button{
padding:10px;border-radius:8px;border:none;
}
.controls button{
background:#ff9800;color:white;cursor:pointer;
}

.card{
background:rgba(255,255,255,0.15);
padding:15px;border-radius:15px;margin-bottom:15px;
}
.stats{
display:grid;grid-template-columns:1fr 1fr;gap:15px;
}
.day{
width:32px;height:32px;display:inline-flex;
align-items:center;justify-content:center;
margin:3px;border-radius:6px;font-size:12px;
cursor:pointer;
}
.happy{background:#4caf50;}
.normal{background:#ffc107;}
.sad{background:#f44336;}
progress{width:100%;}
.logout{
background:red;border:none;padding:8px 12px;
border-radius:8px;color:white;cursor:pointer;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="background" id="loginPage">
<div class="bubble" style="width:80px;height:80px;left:10%;animation-duration:18s;"></div>
<div class="bubble" style="width:120px;height:120px;left:30%;animation-duration:22s;"></div>
<div class="bubble" style="width:60px;height:60px;left:50%;animation-duration:15s;"></div>
<div class="bubble" style="width:100px;height:100px;left:70%;animation-duration:25s;"></div>

<div class="login-box">
<h1>ğŸŒŸ HabitVerse</h1>
<p>Turn habits into a game of success</p>
<input type="text" id="username" placeholder="Enter your name">
<button onclick="login()">Enter</button>
</div>
</div>

<!-- APP -->
<div id="appPage">

<div class="top-bar">
<h2>Welcome, <span id="userDisplay"></span></h2>
<button class="logout" onclick="logout()">Logout</button>
</div>

<div class="controls card">
<input type="text" id="habitInput" placeholder="Enter habit">
<select id="mood">
<option value="happy">ğŸ˜„ Happy</option>
<option value="normal">ğŸ˜ Normal</option>
<option value="sad">ğŸ˜¢ Sad</option>
</select>
<button onclick="addHabit()">Add</button>
</div>

<div class="stats">
<div class="card">
<h3>ğŸ”¥ Streak</h3>
<p><span id="streak">0</span> days</p>
<h3>ğŸ® Level</h3>
<p><span id="level">1</span></p>
<progress id="xpBar" value="0" max="100"></progress>
</div>

<div class="card">
<h3>ğŸ¤– AI Coach</h3>
<p id="aiMessage"></p>
</div>
</div>

<div class="card">
<h3>ğŸ† Achievements</h3>
<div id="badges"></div>
</div>

<div class="card">
<h3>ğŸ“‹ Habits</h3>
<div id="habits"></div>
</div>

<div class="card">
<h3>ğŸ¨ Calendar</h3>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
<button onclick="changeMonth(-1)">â¬…</button>
<h4 id="calendarTitle"></h4>
<button onclick="changeMonth(1)">â¡</button>
</div>
<div id="calendar"></div>
</div>

<div class="card">
<h3>ğŸ“Š Mood Progress (Daily)</h3>
<canvas id="chart"></canvas>
</div>

</div>

<script>
let currentUser=localStorage.getItem("user");
let habits=[];
let days={};
let xp=0;
let levelValue=1;

let selectedMonth=new Date().getMonth();
let selectedYear=new Date().getFullYear();

function login(){
let name=username.value.trim();
if(!name)return alert("Enter name");
localStorage.setItem("user",name);
currentUser=name;
loadUserData();
showApp();
}
function logout(){localStorage.removeItem("user");location.reload();}

function loadUserData(){
habits=JSON.parse(localStorage.getItem(currentUser+"_habits"))||[];
days=JSON.parse(localStorage.getItem(currentUser+"_days"))||{};
xp=Number(localStorage.getItem(currentUser+"_xp"))||0;
levelValue=Number(localStorage.getItem(currentUser+"_level"))||1;
}
function saveData(){
localStorage.setItem(currentUser+"_habits",JSON.stringify(habits));
localStorage.setItem(currentUser+"_days",JSON.stringify(days));
localStorage.setItem(currentUser+"_xp",xp);
localStorage.setItem(currentUser+"_level",levelValue);
}

if(currentUser){loadUserData();showApp();}

function showApp(){
loginPage.style.display="none";
appPage.style.display="block";
userDisplay.innerText=currentUser;
display();
}

function addHabit(){
let habit=habitInput.value.trim();
let mood=document.getElementById("mood").value;
if(!habit)return alert("Enter habit");
habits.push({name:habit,mood:mood});
let today=new Date().getDate();
days[today]=mood;
xp+=10;if(xp>=100){levelValue++;xp=0;}
saveData();display();
habitInput.value="";
}

function removeHabit(i){habits.splice(i,1);saveData();display();}

function calculateStreak(){
let s=0,t=new Date().getDate();
for(let i=t;i>0;i--){if(days[i])s++;else break;}
return s;
}

function display(){
document.getElementById("habits").innerHTML=
habits.map((item,i)=>`<div class="card">ğŸ”¥ ${item.name} | ${item.mood}
<button onclick="removeHabit(${i})"
style="float:right;background:red;border:none;padding:5px 8px;border-radius:6px;color:white;">âŒ</button>
</div>`).join("");

streak.innerText=calculateStreak();
level.innerText=levelValue;
xpBar.value=xp;

renderCalendar();
aiCoach();
updateChart();
checkBadges();
}

function changeMonth(direction){
selectedMonth+=direction;
if(selectedMonth<0){selectedMonth=11;selectedYear--;}
if(selectedMonth>11){selectedMonth=0;selectedYear++;}
renderCalendar();
}

function renderCalendar(){
let calendar=document.getElementById("calendar");
calendar.innerHTML="";
let firstDay=new Date(selectedYear,selectedMonth,1).getDay();
let totalDays=new Date(selectedYear,selectedMonth+1,0).getDate();
let monthName=new Date(selectedYear,selectedMonth)
.toLocaleString('default',{month:'long'});
calendarTitle.innerText=monthName+" "+selectedYear;

for(let i=0;i<firstDay;i++){
let empty=document.createElement("div");
empty.className="day";
empty.style.visibility="hidden";
calendar.appendChild(empty);
}
for(let i=1;i<=totalDays;i++){
let d=document.createElement("div");
d.className="day";d.innerText=i;
if(days[i])d.classList.add(days[i]);
d.onclick=function(){showDayHistory(i);}
calendar.appendChild(d);
}
}

function showDayHistory(day){
let mood=days[day];
if(!mood)return alert("No habit completed on this day.");
alert("Day "+day+"\nMood: "+mood);
}

function aiCoach(){
let moods=Object.values(days);
aiMessage.innerText=
moods.includes("sad")?"Tomorrow is a fresh start ğŸ’ª":
moods.includes("happy")?"Your habits bring happiness ğŸŒŸ":
"Stay consistent ğŸš€";
}

/* âœ… UPDATED DAILY MOOD PROGRESS CHART */
function updateChart(){
let labels=[];
let moodValues=[];

let sortedDays=Object.keys(days).sort((a,b)=>a-b);

sortedDays.forEach(day=>{
labels.push("Day "+day);
if(days[day]=="happy") moodValues.push(3);
else if(days[day]=="normal") moodValues.push(2);
else if(days[day]=="sad") moodValues.push(1);
});

let ctx=document.getElementById("chart").getContext("2d");
if(window.myChart) window.myChart.destroy();

window.myChart=new Chart(ctx,{
type:"line",
data:{
labels:labels,
datasets:[{
label:"Mood Progress",
data:moodValues,
borderColor:"cyan",
backgroundColor:"rgba(0,255,255,0.2)",
tension:0.3,
fill:true
}]
},
options:{
scales:{
y:{
ticks:{
callback:function(value){
if(value==3)return "Happy ğŸ˜„";
if(value==2)return "Normal ğŸ˜";
if(value==1)return "Sad ğŸ˜¢";
},
stepSize:1,
min:1,
max:3
}
}
}
});
}

function checkBadges(){
let b=document.getElementById("badges");
b.innerHTML="";
let streakVal=calculateStreak();
if(streakVal>=3)b.innerHTML+="<p>ğŸ”¥ 3-Day Streak</p>";
if(streakVal>=7)b.innerHTML+="<p>ğŸ’ 7-Day Master</p>";
if(habits.length>=5)b.innerHTML+="<p>ğŸš€ 5 Habits Creator</p>";
if(levelValue>=5)b.innerHTML+="<p>ğŸ‘‘ Level 5 Achiever</p>";
if(b.innerHTML==="")b.innerHTML="<p>No badges yet ğŸ’ª</p>";
}
</script>

</body>
</html>
